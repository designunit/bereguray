import s from './styles.module.css'
import { useState, useEffect } from 'react'

export type BubbleProps = {
    style?: React.CSSProperties
    duration?: number
    color?: string
    opacity?: number
    picturePath?: string
}

function getValues() {
    const keyFrames = [
        'M0.504945 0.0798826C0.57125 0.0561591 0.643505 -0.0291317 0.702467 0.0102251C0.769698 0.0551018 0.727095 0.173593 0.759073 0.249511C0.777937 0.294296 0.816483 0.325816 0.849922 0.36029C0.895524 0.407303 0.973401 0.427999 0.993575 0.491272C1.01226 0.549881 0.988074 0.622815 0.948275 0.668763C0.905234 0.718452 0.817377 0.69955 0.772054 0.747013C0.734446 0.786396 0.763216 0.866643 0.723687 0.903953C0.686392 0.939154 0.625385 0.921021 0.57605 0.932012C0.525586 0.943256 0.478017 0.962114 0.426971 0.97006C0.363955 0.979871 0.290214 1.0224 0.23795 0.984648C0.184233 0.945849 0.221886 0.844399 0.180373 0.791946C0.136568 0.736596 0.0181766 0.755904 0.00187867 0.686362C-0.0148224 0.6151 0.0845813 0.568044 0.11206 0.500458C0.131407 0.452872 0.118981 0.396758 0.138872 0.349413C0.159072 0.301333 0.191778 0.260252 0.228256 0.223886C0.265158 0.187098 0.308294 0.158702 0.354063 0.134882C0.402112 0.109875 0.454117 0.0980687 0.504945 0.0798826Z ;',
        'M0.573262 0.0165297C0.636415 -0.00147284 0.705922 -0.0061385 0.769855 0.00938698C0.834857 0.025172 0.909125 0.050939 0.940039 0.105598C0.974118 0.165853 0.928294 0.24019 0.938405 0.307405C0.945385 0.353808 0.983827 0.391963 0.990109 0.43845C0.99645 0.485376 0.974023 0.531139 0.975024 0.578413C0.976372 0.642059 1.00995 0.70413 0.997058 0.766685C0.982918 0.835287 0.966342 0.922861 0.897739 0.953389C0.825774 0.985413 0.742948 0.907088 0.663414 0.915155C0.591084 0.922492 0.535651 1.01751 0.466363 0.997145C0.392173 0.975339 0.397976 0.866599 0.33914 0.819843C0.291325 0.781845 0.202439 0.802695 0.163852 0.756743C0.125367 0.710913 0.168659 0.638605 0.142702 0.585912C0.111488 0.522548 0.0093475 0.49427 0.000548991 0.425232C-0.00755045 0.36168 0.0762595 0.318433 0.100985 0.258584C0.128414 0.192194 0.0852446 0.0855481 0.154263 0.0531717C0.235575 0.0150286 0.32805 0.117355 0.419007 0.109401C0.480802 0.103997 0.513995 0.0334247 0.573262 0.0165297Z ;',
        'M0.486275 0.00826082C0.548427 0.0348008 0.559601 0.120417 0.610946 0.163868C0.644469 0.192236 0.6985 0.186797 0.731485 0.215767C0.764505 0.244768 0.763417 0.300006 0.797538 0.327749C0.856688 0.375844 0.984478 0.359272 0.999056 0.433329C1.01268 0.502559 0.874684 0.515726 0.84738 0.580939C0.824093 0.636558 0.896322 0.708991 0.862619 0.759197C0.829993 0.807797 0.739331 0.772059 0.693948 0.809497C0.638798 0.854992 0.648271 0.959231 0.583255 0.989656C0.525347 1.01676 0.448418 0.986253 0.397148 0.94839C0.343659 0.908888 0.345648 0.824946 0.297883 0.778906C0.262196 0.744508 0.204987 0.744991 0.161317 0.721078C0.104497 0.689964 0.00452883 0.679639 0.000160599 0.61588C-0.0048499 0.542746 0.108798 0.514046 0.142658 0.448728C0.163073 0.409345 0.153119 0.361971 0.154677 0.317802C0.156996 0.25206 0.122134 0.179898 0.154179 0.122138C0.183115 0.0699823 0.254025 0.0554076 0.311112 0.035832C0.367421 0.0165236 0.431579 -0.0150956 0.486275 0.00826082Z ;',
        'M0.543878 0.0258535C0.600408 0.0412809 0.64311 0.0843357 0.696904 0.107079C0.748462 0.128877 0.826315 0.111699 0.855915 0.157778C0.889712 0.210392 0.822842 0.284443 0.847521 0.341551C0.869922 0.393391 0.955347 0.397698 0.981318 0.447974C1.00616 0.496064 1.00504 0.55754 0.984983 0.607654C0.964861 0.657941 0.899834 0.678288 0.870731 0.72433C0.838111 0.775937 0.859468 0.862477 0.804958 0.892464C0.749463 0.922993 0.678282 0.845885 0.617135 0.863839C0.545697 0.884816 0.51679 1.01632 0.444482 0.998311C0.368739 0.979445 0.385242 0.860492 0.344886 0.796028C0.321157 0.758125 0.295028 0.719004 0.255478 0.696404C0.190469 0.659255 0.0949733 0.677198 0.0435814 0.62385C-0.00105531 0.577515 -0.00814991 0.500476 0.00767515 0.439173C0.0237603 0.376862 0.0861125 0.337116 0.130074 0.288799C0.167085 0.24812 0.213579 0.217586 0.248097 0.174928C0.289019 0.124356 0.294031 0.0429864 0.35305 0.0132406C0.410009 -0.0154668 0.482013 0.0089707 0.543878 0.0258535Z ;',
        'M0.491651 0.0306987C0.534908 0.0396327 0.576483 0.0535997 0.620225 0.0578974C0.677931 0.0635669 0.740611 0.0291322 0.792426 0.0602497C0.841658 0.0898157 0.877457 0.154551 0.889039 0.219333C0.900884 0.285588 0.839459 0.352306 0.856208 0.417007C0.878758 0.504114 1.02771 0.547826 0.995444 0.630375C0.959378 0.722634 0.819709 0.63589 0.748839 0.691664C0.706522 0.724967 0.734311 0.81829 0.699938 0.862934C0.666536 0.906316 0.610836 0.909136 0.565007 0.930423C0.512561 0.954783 0.463236 1.00917 0.407705 0.998672C0.352579 0.988254 0.327689 0.903192 0.276682 0.875937C0.216742 0.843909 0.125614 0.889667 0.0859639 0.826755C0.0463694 0.763931 0.109641 0.670234 0.0981031 0.592589C0.0878888 0.523855 0.0365058 0.473432 0.0233523 0.405427C0.0086213 0.329265 -0.0173477 0.239354 0.0169369 0.172949C0.0524491 0.104166 0.135578 0.100979 0.19723 0.0686449C0.245894 0.0431224 0.292007 0.00780998 0.344783 0.00100807C0.394566 -0.00540816 0.442304 0.0205066 0.491651 0.0306987Z ;',
        'M0.540077 0.00186417C0.611254 0.0192959 0.595955 0.15071 0.664505 0.176218C0.733449 0.201873 0.810178 0.100211 0.878353 0.127739C0.934794 0.150528 0.949032 0.231418 0.948303 0.290811C0.947552 0.352076 0.865116 0.397645 0.874297 0.458261C0.884223 0.52379 0.985119 0.549652 0.997379 0.614807C1.00821 0.672372 0.985137 0.746223 0.934415 0.777761C0.875812 0.8142 0.792494 0.758377 0.727538 0.782591C0.677488 0.801249 0.660763 0.863638 0.618403 0.895564C0.563872 0.936663 0.510546 0.989175 0.442101 0.997718C0.375655 1.00601 0.292657 0.9927 0.251461 0.94136C0.204461 0.882787 0.267447 0.781515 0.221179 0.722396C0.174679 0.662982 0.04907 0.699582 0.0113469 0.634558C-0.021833 0.577364 0.0248587 0.501029 0.0603425 0.445157C0.0939328 0.392266 0.15903 0.368489 0.206664 0.327015C0.240387 0.297652 0.273591 0.268849 0.302098 0.234661C0.3351 0.195084 0.351781 0.144817 0.388725 0.108678C0.433045 0.0653223 0.479098 -0.0130699 0.540077 0.00186417Z ;',
        'M0.530346 0.0293257C0.590299 0.025015 0.65063 -0.0145574 0.707754 0.00577064C0.764466 0.0259524 0.796423 0.0907242 0.836996 0.13845C0.875475 0.183714 0.914807 0.227737 0.942319 0.281691C0.970374 0.33671 1.00084 0.39513 0.999982 0.458089C0.999122 0.520892 0.959796 0.574118 0.937519 0.632031C0.917111 0.685085 0.894802 0.735636 0.873057 0.788055C0.847169 0.850462 0.855445 0.952122 0.795836 0.973575C0.727222 0.998268 0.668054 0.888951 0.595814 0.887831C0.541229 0.886985 0.503972 0.953367 0.451108 0.96823C0.388723 0.98577 0.313339 1.02157 0.259921 0.982273C0.205508 0.942238 0.221633 0.846946 0.196401 0.780829C0.176473 0.728609 0.153711 0.678933 0.125937 0.631172C0.0893204 0.568205 0.0196772 0.525453 0.00547428 0.452503C-0.00818673 0.382336 0.00257798 0.293746 0.0507382 0.244934C0.105194 0.18974 0.202864 0.232041 0.265705 0.188746C0.315119 0.154702 0.310608 0.0614658 0.361768 0.0306472C0.411388 0.000755721 0.473792 0.033392 0.530346 0.0293257Z ;'
    ]
    const values = []

    for (let index = 0; index < 4; index++) { // 4 is related to keyTimes and keySplines in <animate>
        const element = keyFrames.splice(Math.random() * keyFrames.length, 1)
        values.unshift(element)
    }
    values.push(values[0])

    return values.reduce((acc, value) => acc+value, '')
}

export const Bubble: React.FC<BubbleProps> = ({ 
    duration = 15 + Math.random()*60, 
    picturePath, 
    color = 'white', 
    opacity = 1,
    ...props 
}) => {
    const [values, setValues] = useState<string>()

    useEffect(() => {
        setValues(getValues())
    }, [])

    const path = (
        <path fillRule="evenodd" clipRule="evenodd" fill={color} opacity={opacity}>
            <animate dur={`${duration}s`} repeatCount="indefinite" attributeName='d'   
                calcMode='spline' // ease-in-out
                keyTimes="0 ; 0.25 ; 0.5 ; 0.75 ; 1"
                keySplines="0.5 0 0.5 1 ; 0.5 0 0.5 1 ; 0.5 0 0.5 1 ; 0.5 0 0.5 1"
                values = {values}
            /> 
        </path>
    )

    return (
        <>
            <svg fill="none" xmlns="http://www.w3.org/2000/svg"
                style={{...props.style, height: picturePath ? 0 : props.style?.height}} 

                preserveAspectRatio="none"
                viewBox='0 0 1 1'
            >
                {!picturePath ? path : (
                    <defs>
                        <clipPath 
                            id='clipPath'
                            clipPathUnits='objectBoundingBox'
                        >
                            {path}
                        </clipPath>
                    </defs>
                )}
            </svg>

            {!picturePath ? null : (
                <img src={picturePath} className={s.img} style={props.style} />
            )}
        </>
    )
}

Bubble.defaultProps = {
    duration: 15 + Math.random()*60, 
}